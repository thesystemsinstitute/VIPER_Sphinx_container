Sphinx-AutoAPI Tutorial
=======================

.. note::
   
   **Package Resources:**
   
   - `PyPI Package <https://pypi.org/project/sphinx-autoapi/>`_
   - `Official Documentation <https://sphinx-autoapi.readthedocs.io/>`_
   - :doc:`See Working Example <../../examples/sphinx-autoapi-example>`


This tutorial demonstrates how to use sphinx-autoapi to automatically generate API documentation from your source code.

What is Sphinx-AutoAPI?
------------------------

sphinx-autoapi is a Sphinx extension that provides:

- Automatic API documentation generation
- No imports required
- Works with uninstallable code
- Multiple language support (Python, JavaScript, Go, .NET)
- Customizable templates
- Type annotation support
- Better performance than autodoc
- Clean separation
- Consistent output
- Template customization

This generates complete API documentation by parsing source code directly without importing it.

Installation
------------

sphinx-autoapi is already installed in this container. To verify:

.. code-block:: bash

   docker run --rm kensai-sphinx:latest python -c "import autoapi; print('Installed')"

Configuration
-------------

Basic Setup
~~~~~~~~~~~

Add to your ``conf.py``:

.. code-block:: python

   extensions = [
       'autoapi.extension',
   ]
   
   # AutoAPI configuration
   autoapi_dirs = ['../mypackage']
   autoapi_type = 'python'

Advanced Configuration
~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: python

   extensions = ['autoapi.extension']
   
   # Directories to document
   autoapi_dirs = ['../mypackage']
   
   # Language type
   autoapi_type = 'python'
   
   # Output directory (relative to source)
   autoapi_root = 'api'
   
   # Template directory
   autoapi_template_dir = '_autoapi_templates'
   
   # Options
   autoapi_options = [
       'members',
       'undoc-members',
       'show-inheritance',
       'show-module-summary',
       'special-members',
       'imported-members',
   ]
   
   # Ignore patterns
   autoapi_ignore = [
       '*/migrations/*',
       '*tests/*',
       '*test_*.py',
   ]
   
   # Keep generated files
   autoapi_keep_files = True
   
   # Generate API docs
   autoapi_generate_api_docs = True
   
   # Add module names
   autoapi_add_toctree_entry = True
   
   # Python-specific settings
   autoapi_python_class_content = 'both'  # both, class, init
   autoapi_python_use_implicit_namespaces = False
   
   # Member ordering
   autoapi_member_order = 'groupwise'  # alphabetical, groupwise, bysource

Basic Usage
-----------

Generate API Documentation
~~~~~~~~~~~~~~~~~~~~~~~~~~~

Simply build your documentation:

.. code-block:: bash

   docker run --rm \
     -v $(pwd):/project \
     kensai-sphinx:latest \
     sphinx-build -b html /project/docs /project/docs/_build/html

AutoAPI automatically generates documentation from ``autoapi_dirs``.

Include in Toctree
~~~~~~~~~~~~~~~~~~

``docs/index.rst``:

.. code-block:: rst

   .. toctree::
      :maxdepth: 2
      
      installation
      usage
      api/index
      changelog

The ``api/index`` is automatically generated by AutoAPI.

Practical Examples
------------------

Example 1: Simple Python Package
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Project structure:

.. code-block:: text

   myproject/
   ├── mypackage/
   │   ├── __init__.py
   │   ├── core.py
   │   ├── utils.py
   │   └── models.py
   └── docs/
       ├── conf.py
       └── index.rst

``mypackage/core.py``:

.. code-block:: python

   """Core functionality."""
   
   from typing import List, Optional
   
   class Client:
       """
       Main client for the API.
       
       Parameters
       ----------
       api_key : str
           API authentication key
       base_url : str, optional
           Base URL for the API (default: https://api.example.com)
       timeout : int, optional
           Request timeout in seconds (default: 30)
       
       Examples
       --------
       >>> client = Client(api_key="your-key")
       >>> data = client.fetch_data()
       """
       
       def __init__(
           self,
           api_key: str,
           base_url: str = "https://api.example.com",
           timeout: int = 30
       ):
           self.api_key = api_key
           self.base_url = base_url
           self.timeout = timeout
       
       def fetch_data(self, limit: int = 10) -> List[dict]:
           """
           Fetch data from the API.
           
           Parameters
           ----------
           limit : int, optional
               Maximum number of items to fetch (default: 10)
           
           Returns
           -------
           List[dict]
               List of data items
           
           Raises
           ------
           ValueError
               If limit is less than 1
           """
           if limit < 1:
               raise ValueError("Limit must be at least 1")
           return []

``docs/conf.py``:

.. code-block:: python

   extensions = ['autoapi.extension']
   
   autoapi_dirs = ['../mypackage']
   autoapi_type = 'python'
   autoapi_root = 'api'
   
   autoapi_options = [
       'members',
       'undoc-members',
       'show-inheritance',
       'show-module-summary',
   ]

AutoAPI generates complete documentation from the source code!

Example 2: Complex Package Structure
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

``docs/conf.py``:

.. code-block:: python

   extensions = ['autoapi.extension']
   
   # Document multiple packages
   autoapi_dirs = [
       '../mypackage',
       '../mypackage/plugins',
   ]
   
   autoapi_type = 'python'
   
   # Ignore test files and migrations
   autoapi_ignore = [
       '*migrations/*',
       '*/tests/*',
       '*test_*.py',
       '*/conftest.py',
   ]
   
   # Keep generated RST files for customization
   autoapi_keep_files = True
   
   # Template customization
   autoapi_template_dir = '_autoapi_templates'
   
   # Show everything
   autoapi_options = [
       'members',
       'undoc-members',
       'private-members',
       'show-inheritance',
       'show-module-summary',
       'special-members',
   ]
   
   # Class content
   autoapi_python_class_content = 'both'
   
   # Member order
   autoapi_member_order = 'bysource'

Example 3: Custom Templates
~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Create ``docs/_autoapi_templates/python/module.rst``:

.. code-block:: rst

   {% if not obj.display %}
   :orphan:
   
   {% endif %}
   {{ obj.name }}
   {{ "=" * obj.name|length }}
   
   .. py:module:: {{ obj.name }}
   
   {% if obj.docstring %}
   .. autoapi-nested-parse::
   
      {{ obj.docstring|indent(3) }}
   
   {% endif %}
   
   {% block subpackages %}
   {% set visible_subpackages = obj.subpackages|selectattr("display")|list %}
   {% if visible_subpackages %}
   
   Subpackages
   -----------
   
   .. toctree::
      :maxdepth: 1
   
   {% for subpackage in visible_subpackages %}
      {{ subpackage.short_name }}/index.rst
   {% endfor %}
   
   {% endif %}
   {% endblock %}
   
   {# Rest of template... #}

Configure:

.. code-block:: python

   autoapi_template_dir = '_autoapi_templates'

Example 4: JavaScript Documentation
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

``docs/conf.py``:

.. code-block:: python

   extensions = ['autoapi.extension']
   
   # Document JavaScript
   autoapi_dirs = ['../src']
   autoapi_type = 'javascript'
   autoapi_file_patterns = ['*.js', '*.jsx']
   
   autoapi_options = [
       'members',
       'undoc-members',
       'show-module-summary',
   ]

Advanced Features
-----------------

Filter Members
~~~~~~~~~~~~~~

``docs/conf.py``:

.. code-block:: python

   def skip_member(app, what, name, obj, skip, options):
       """Skip private members starting with single underscore."""
       if name.startswith('_') and not name.startswith('__'):
           return True
       return skip
   
   def setup(app):
       app.connect('autoapi-skip-member', skip_member)

Custom Formatting
~~~~~~~~~~~~~~~~~

.. code-block:: python

   def autoapi_prepare_jinja_env(jinja_env):
       """Add custom filters to Jinja environment."""
       jinja_env.filters['custom_format'] = lambda x: x.upper()
   
   def setup(app):
       app.connect('autoapi-prepare-jinja-env', autoapi_prepare_jinja_env)

Type Hints Display
~~~~~~~~~~~~~~~~~~

.. code-block:: python

   # Show type hints in signatures
   autoapi_python_use_implicit_namespaces = True
   
   # Napoleon for Google/NumPy docstrings
   extensions = [
       'autoapi.extension',
       'sphinx.ext.napoleon',
   ]

Inheritance Diagrams
~~~~~~~~~~~~~~~~~~~~

.. code-block:: python

   extensions = [
       'autoapi.extension',
       'sphinx.ext.inheritance_diagram',
       'sphinx.ext.graphviz',
   ]
   
   # Enable in autoapi options
   autoapi_options = [
       'members',
       'show-inheritance',
       'show-inheritance-diagram',
   ]

Docker Integration
------------------

Build API Documentation
~~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: bash

   docker run --rm \
     -v $(pwd):/project \
     kensai-sphinx:latest \
     sphinx-build -b html /project/docs /project/docs/_build/html

Multi-Stage Build
~~~~~~~~~~~~~~~~~

``Dockerfile``:

.. code-block:: dockerfile

   FROM python:3.11-alpine as builder
   
   # Install Sphinx and AutoAPI
   RUN pip install sphinx sphinx-autoapi
   
   # Copy source code
   COPY mypackage/ /src/mypackage/
   COPY docs/ /src/docs/
   
   # Build docs
   WORKDIR /src/docs
   RUN sphinx-build -b html . _build/html
   
   # Production image
   FROM nginx:alpine
   COPY --from=builder /src/docs/_build/html /usr/share/nginx/html

CI/CD Integration
-----------------

GitHub Actions
~~~~~~~~~~~~~~

.. code-block:: yaml

   name: Build API Documentation
   
   on:
     push:
       paths:
         - 'mypackage/**/*.py'
         - 'docs/**'
   
   jobs:
     build:
       runs-on: ubuntu-latest
       steps:
         - uses: actions/checkout@v3
         
         - name: Build Documentation
           run: |
             docker run --rm -v $(pwd):/project \
               kensai-sphinx:latest \
               sphinx-build -b html /project/docs /project/docs/_build/html
         
         - name: Deploy to GitHub Pages
           uses: peaceiris/actions-gh-pages@v3
           with:
             github_token: ${{ secrets.GITHUB_TOKEN }}
             publish_dir: ./docs/_build/html

Best Practices
--------------

1. **Write Comprehensive Docstrings**
   
   AutoAPI relies on good documentation

2. **Use Type Hints**
   
   Improves generated documentation

3. **Ignore Test Files**
   
   Keep API docs clean

4. **Customize Templates**
   
   Match your documentation style

5. **Keep Generated Files**
   
   For customization and debugging

6. **Use with Napoleon**
   
   Support Google/NumPy docstrings

Troubleshooting
---------------

Module Not Found
~~~~~~~~~~~~~~~~

**Solution:**

Check autoapi_dirs path:

.. code-block:: python

   autoapi_dirs = ['../mypackage']  # Relative to conf.py

No Documentation Generated
~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Solution:**

Enable verbose output:

.. code-block:: bash

   sphinx-build -v -b html docs docs/_build/html

Check autoapi_ignore patterns.

Type Hints Not Showing
~~~~~~~~~~~~~~~~~~~~~~~

**Solution:**

.. code-block:: python

   autoapi_python_use_implicit_namespaces = True

Private Members Showing
~~~~~~~~~~~~~~~~~~~~~~~

**Solution:**

Remove 'private-members' from options:

.. code-block:: python

   autoapi_options = ['members', 'undoc-members']

Next Steps
----------

1. Configure autoapi_dirs
2. Set autoapi_options
3. Customize templates if needed
4. Build documentation
5. Review generated API docs

Additional Resources
--------------------

- :doc:`sphinx-automodapi` - Alternative approach
- :doc:`../sphinx-basics` - Learn Sphinx fundamentals
- `AutoAPI Documentation <https://sphinx-autoapi.readthedocs.io/>`_
- `Sphinx autodoc <https://www.sphinx-doc.org/en/master/usage/extensions/autodoc.html>`_
