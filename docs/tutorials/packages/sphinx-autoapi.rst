Sphinx-AutoAPI Tutorial
=======================

.. note::
   
   **Package Resources:**
   
   - `PyPI Package <https://pypi.org/project/sphinx-autoapi/>`_
   - `API Documentation <../../pdoc/sphinx_autoapi/index.html>`_
   - `Manual <https://sphinx-autoapi.readthedocs.io/en/latest/>`_
   - :doc:`Working Example <../../examples/sphinx-autoapi-example>`


.. contents:: Table of Contents
   :local:
   :depth: 2

This tutorial demonstrates how to use sphinx-autoapi to automatically generate API documentation from your source code.

What is Sphinx-AutoAPI?
------------------------

sphinx-autoapi is a Sphinx extension that provides:

- Automatic API documentation generation
- No imports required
- Works with uninstallable code
- Multiple language support (Python, JavaScript, Go, .NET)
- Customizable templates
- Type annotation support
- Better performance than autodoc
- Clean separation
- Consistent output
- Template customization

This generates complete API documentation by parsing source code directly without importing it.


The sphinx-autoapi extension automatically generates comprehensive API documentation by parsing source code, supporting Python, .NET, JavaScript, and Go.

Installation
------------

sphinx-autoapi is already installed in this container. To verify:

.. code-block:: bash

   docker run --rm kensai-sphinx:latest python -c "import autoapi; print('Installed')"

Configuration
-------------

Basic Setup
~~~~~~~~~~~

Add to your ``conf.py``:

.. code-block:: python

   extensions = [
       'autoapi.extension',
   ]
   
   # AutoAPI configuration
   autoapi_dirs = ['../mypackage']
   autoapi_type = 'python'

Advanced Configuration
~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: python

   extensions = ['autoapi.extension']
   
   # Directories to document
   autoapi_dirs = ['../mypackage']
   
   # Language type
   autoapi_type = 'python'
   
   # Output directory (relative to source)
   autoapi_root = 'api'
   
   # Template directory
   autoapi_template_dir = '_autoapi_templates'
   
   # Options
   autoapi_options = [
       'members',
       'undoc-members',
       'show-inheritance',
       'show-module-summary',
       'special-members',
       'imported-members',
   ]
   
   # Ignore patterns
   autoapi_ignore = [
       '*/migrations/*',
       '*tests/*',
       '*test_*.py',
   ]
   
   # Keep generated files
   autoapi_keep_files = True
   
   # Generate API docs
   autoapi_generate_api_docs = True
   
   # Add module names
   autoapi_add_toctree_entry = True
   
   # Python-specific settings
   autoapi_python_class_content = 'both'  # both, class, init
   autoapi_python_use_implicit_namespaces = False
   
   # Member ordering
   autoapi_member_order = 'groupwise'  # alphabetical, groupwise, bysource

Basic Usage
-----------

Generate API Documentation
~~~~~~~~~~~~~~~~~~~~~~~~~~~

Simply build your documentation:

.. code-block:: bash

   docker run --rm \
     -v $(pwd):/project \
     kensai-sphinx:latest \
     sphinx-build -b html /project/docs /project/docs/_build/html

AutoAPI automatically generates documentation from ``autoapi_dirs``.

Include in Toctree
~~~~~~~~~~~~~~~~~~

``docs/index.rst``:

.. code-block:: rst

   .. toctree::
      :maxdepth: 2
      
      installation
      usage
      api/index
      changelog

The ``api/index`` is automatically generated by AutoAPI.

Advanced Features
-----------------

Filter Members
~~~~~~~~~~~~~~

``docs/conf.py``:

.. code-block:: python

   def skip_member(app, what, name, obj, skip, options):
       """Skip private members starting with single underscore."""
       if name.startswith('_') and not name.startswith('__'):
           return True
       return skip
   
   def setup(app):
       app.connect('autoapi-skip-member', skip_member)

Custom Formatting
~~~~~~~~~~~~~~~~~

.. code-block:: python

   def autoapi_prepare_jinja_env(jinja_env):
       """Add custom filters to Jinja environment."""
       jinja_env.filters['custom_format'] = lambda x: x.upper()
   
   def setup(app):
       app.connect('autoapi-prepare-jinja-env', autoapi_prepare_jinja_env)

Type Hints Display
~~~~~~~~~~~~~~~~~~

.. code-block:: python

   # Show type hints in signatures
   autoapi_python_use_implicit_namespaces = True
   
   # Napoleon for Google/NumPy docstrings
   extensions = [
       'autoapi.extension',
       'sphinx.ext.napoleon',
   ]

Inheritance Diagrams
~~~~~~~~~~~~~~~~~~~~

.. code-block:: python

   extensions = [
       'autoapi.extension',
       'sphinx.ext.inheritance_diagram',
       'sphinx.ext.graphviz',
   ]
   
   # Enable in autoapi options
   autoapi_options = [
       'members',
       'show-inheritance',
       'show-inheritance-diagram',
   ]

Docker Integration
------------------

Build API Documentation
~~~~~~~~~~~~~~~~~~~~~~~

.. code-block:: bash

   docker run --rm \
     -v $(pwd):/project \
     kensai-sphinx:latest \
     sphinx-build -b html /project/docs /project/docs/_build/html

Multi-Stage Build
~~~~~~~~~~~~~~~~~

``Dockerfile``:

.. code-block:: dockerfile

   FROM python:3.11-alpine as builder
   
   # Install Sphinx and AutoAPI
   RUN pip install sphinx sphinx-autoapi
   
   # Copy source code
   COPY mypackage/ /src/mypackage/
   COPY docs/ /src/docs/
   
   # Build docs
   WORKDIR /src/docs
   RUN sphinx-build -b html . _build/html
   
   # Production image
   FROM nginx:alpine
   COPY --from=builder /src/docs/_build/html /usr/share/nginx/html

CI/CD Integration
-----------------

GitHub Actions
~~~~~~~~~~~~~~

.. code-block:: yaml

   name: Build API Documentation
   
   on:
     push:
       paths:
         - 'mypackage/**/*.py'
         - 'docs/**'
   
   jobs:
     build:
       runs-on: ubuntu-latest
       steps:
         - uses: actions/checkout@v3
         
         - name: Build Documentation
           run: |
             docker run --rm -v $(pwd):/project \
               kensai-sphinx:latest \
               sphinx-build -b html /project/docs /project/docs/_build/html
         
         - name: Deploy to GitHub Pages
           uses: peaceiris/actions-gh-pages@v3
           with:
             github_token: ${{ secrets.GITHUB_TOKEN }}
             publish_dir: ./docs/_build/html

Best Practices
--------------

1. **Write Comprehensive Docstrings**
   
   AutoAPI relies on good documentation

2. **Use Type Hints**
   
   Improves generated documentation

3. **Ignore Test Files**
   
   Keep API docs clean

4. **Customize Templates**
   
   Match your documentation style

5. **Keep Generated Files**
   
   For customization and debugging

6. **Use with Napoleon**
   
   Support Google/NumPy docstrings

Troubleshooting
---------------

Module Not Found
~~~~~~~~~~~~~~~~

**Solution:**

Check autoapi_dirs path:

.. code-block:: python

   autoapi_dirs = ['../mypackage']  # Relative to conf.py

No Documentation Generated
~~~~~~~~~~~~~~~~~~~~~~~~~~~

**Solution:**

Enable verbose output:

.. code-block:: bash

   sphinx-build -v -b html docs docs/_build/html

Check autoapi_ignore patterns.

Type Hints Not Showing
~~~~~~~~~~~~~~~~~~~~~~~

**Solution:**

.. code-block:: python

   autoapi_python_use_implicit_namespaces = True

Private Members Showing
~~~~~~~~~~~~~~~~~~~~~~~

**Solution:**

Remove 'private-members' from options:

.. code-block:: python

   autoapi_options = ['members', 'undoc-members']

Next Steps
----------

1. Configure autoapi_dirs
2. Set autoapi_options
3. Customize templates if needed
4. Build documentation
5. Review generated API docs

Additional Resources
--------------------

- :doc:`sphinx-automodapi` - Alternative approach
- :doc:`../sphinx-basics` - Learn Sphinx fundamentals
- `AutoAPI Documentation <https://sphinx-autoapi.readthedocs.io/>`_
- `Sphinx autodoc <https://www.sphinx-doc.org/en/master/usage/extensions/autodoc.html>`_
